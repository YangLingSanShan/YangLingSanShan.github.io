<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>推荐系统学习（重排序） | YangLingSanShan</title><meta name="author" content="舲."><meta name="copyright" content="舲."><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="lpr的搜推入门（六）">
<meta property="og:type" content="article">
<meta property="og:title" content="推荐系统学习（重排序）">
<meta property="og:url" content="https://yanglingsanshan.github.io/2025/04/22/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%89/index.html">
<meta property="og:site_name" content="YangLingSanShan">
<meta property="og:description" content="lpr的搜推入门（六）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://yanglingsanshan.github.io/img/avatar.png">
<meta property="article:published_time" content="2025-04-22T03:47:00.000Z">
<meta property="article:modified_time" content="2025-04-22T03:55:58.106Z">
<meta property="article:author" content="舲.">
<meta property="article:tag" content="推荐系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yanglingsanshan.github.io/img/avatar.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "推荐系统学习（重排序）",
  "url": "https://yanglingsanshan.github.io/2025/04/22/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%89/",
  "image": "https://yanglingsanshan.github.io/img/avatar.png",
  "datePublished": "2025-04-22T03:47:00.000Z",
  "dateModified": "2025-04-22T03:55:58.106Z",
  "author": [
    {
      "@type": "Person",
      "name": "舲.",
      "url": "https://yanglingsanshan.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/luoxiaohan_3.jpg"><link rel="canonical" href="https://yanglingsanshan.github.io/2025/04/22/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%89/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '推荐系统学习（重排序）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="web_bg" style="background-image: url(/img/luoxiaohan_1.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">YangLingSanShan</span></a><a class="nav-page-title" href="/"><span class="site-name">推荐系统学习（重排序）</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">推荐系统学习（重排序）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-22T03:47:00.000Z" title="发表于 2025-04-22 11:47:00">2025-04-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-22T03:55:58.106Z" title="更新于 2025-04-22 11:55:58">2025-04-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="container post-content" id="article-container"><h1 id="重排序">重排序</h1>
<blockquote>
<p>参考文献：<br>
​		   [1] <a target="_blank" rel="noopener" href="https://www.cs.cmu.edu/~jgc/publication/The_Use_MMR_Diversity_Based_LTMIR_1998.pdf">MMR 多样性算法</a></p>
<p>​		   [2] <a target="_blank" rel="noopener" href="https://proceedings.neurips.cc/paper_files/paper/2018/file/dbbf603ff0e99629dda5d75b6f75f966-Paper.pdf">Fast Greedy MAP Inference for Determinantal Point Process to Improve Recommendation Diversity</a><br>
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/678664853">推荐系统｜个人学习笔记 - 知乎</a></p>
<p>​		   <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/647143887">推荐系统中的重排算法 - 知乎</a></p>
</blockquote>
<h2 id="重排序的必要性：">重排序的必要性：</h2>
<h3 id="重排序定义：">重排序定义：</h3>
<p>对精排生成的Top-N个物品的序列进行重新排序，生成一个Top-K个物品的序列，作为推荐系统最后的结果，直接展现给用户。</p>
<h3 id="必要性：">必要性：</h3>
<ol>
<li>
<p><strong>建模物品间的互相影响</strong>：精排模型通常学习的是物品pointwise的得分，直接根据精排分数排序，无法考虑多个商品间的影响，而且同质化严重（相似的商品得分相似所以位置接近，但同时点击的概率很少），缺少发现性，用户体验较差。</p>
</li>
<li>
<p><strong>多样性</strong>：重排序<strong>提升Top-K商品的信息覆盖度、减少信息冗余</strong>。通过展示多种类型的商品，能够提升Top-K商品的覆盖度，同时避免无效曝光多个类似的物品。多样性能带来发现性：用户发现多种商品、新的兴趣，同时系统能了解更多用户。合适的多样性，通常对实现重排序目标有重要的作用。</p>
</li>
</ol>
<h3 id="重排目标：">重排目标：</h3>
<ol>
<li><strong>短期目标</strong>：提升结果的效率（点击、购买、GMV等）；提升结果的多样性、发现性和用户体验；降低负反馈（结果同质化严重、看/点/买了还推）。</li>
<li><strong>长期目标</strong>：提升用户流量深度、停留时长；提升用户复访、留存、长期用户价值。</li>
</ol>
<h3 id="存在问题：">存在问题：</h3>
<ol>
<li><strong>解空间大</strong>：重排序问题是从Top-N个商品的排列，生成Top-K个商品的排列，解空间（$A^N_K$）为指数级，生成最优解为NP-hard问题。</li>
<li>每种Top-K个商品的排列的reward难以预测</li>
<li>海量的状态空间（<strong>用户状态</strong>）和解空间，导致难以有效探索和学</li>
</ol>
<h2 id="推荐系统中的多样性">推荐系统中的多样性</h2>
<h3 id="物品相似性的度量"><strong>物品相似性的度量</strong></h3>
<h4 id="物品属性标签方法"><strong>物品属性标签方法</strong></h4>
<ol>
<li><strong>物品属性标签</strong>：类目、品牌、关键词等</li>
<li><strong>根据一级类目、二级类目、品牌等标签计算相似度</strong>：对以上三个相似度求加权和得到物品相似度，权重由人为设定。</li>
</ol>
<h4 id="物品向量表征"><strong>物品向量表征</strong></h4>
<p>在召回的双塔模型中，物品塔学习物品的向量计算相似度，但是由于长尾数据的问题，这种方法实际效果并不好。一般来说，更多地应用<strong>基于内容的向量表征</strong>。<strong>（CLIP）</strong></p>
<h3 id="提升多样性的方法"><strong>提升多样性的方法</strong></h3>
<h4 id="MMR-多样性算法">MMR 多样性算法</h4>
<h5 id="原理">原理</h5>
<p>Maximal Marginal Relevance（MMR）是最早来自于搜索排序的算法，使用相关性进行排序。要解决的问题设定如下：</p>
<ol>
<li>精排给 n 个候选物品打分，融合之后的<strong>分数</strong>为$reward_1,…,reward_n$;</li>
<li>把第 i 和 j 个物品的<strong>相似度</strong>记作 $sim(i,j)$ ;</li>
<li>根据以上两个值，从 n 个物品中选出 k 个作为曝光的结果，要求既要有高精排分数，也要有多样性。</li>
</ol>
<p>不妨记选择的物品集合为 $S$ ，未选中的物品集合为 $R$ 。那么计算集合 $R$ 中每个物品 $i$ 的 <strong>Marginal Relevance 分数</strong>： $MRi=θ⋅reward_i−(1−θ)⋅max_{j∈S}{sim(i,j)}$ ，其中 $θ$ 是超参数，用于调整精排分数与多样性的权重占比。</p>
<p>基于该分数，此则 MMR 的基本思想为<strong>贪心</strong>：</p>
<ol>
<li>已选中的物品 $S$ 初始化为空集，未选中的物品 $R$ 初始化为全集 ${1,…,n}$ ；</li>
<li>选择精排分数 $reward_i$ 最高的物品，然后从集合 $R$ 移到 $S$ ；</li>
<li>重复上一步做 $k−1$ 轮循环：计算集合中 $R$ 中所有物品的分数 ${MR_i}_{i∈R}$ 、选出分数最高的物品，将其从 R 移到 S</li>
</ol>
<p>其标准公式如下：<br>
$$<br>
M M R=\operatorname{Arg} \max <em>{D</em>{i} \in R \backslash S}\left[\lambda \operatorname{Sim}<em>{1}\left(D</em>{i}, Q\right)-(1-\lambda) \max <em>{D</em>{j} \in S} \operatorname{Sim}<em>{2}\left(D</em>{i}, D_{j}\right)\right]<br>
$$</p>
<h5 id="实际应用">实际应用</h5>
<p>在实际应用，该公式存在<strong>问题</strong>：</p>
<ol>
<li>已选中的物品越多（即集合 S 越大时），越难找出物品 $i∈R$ ，使得 $i$ 与 $S$ 中的物品都不相似；</li>
<li>具体分析下原因：设 $sim$ 的取值范围为 $[0,1]$ 。当 S 很大时，多样性分数 $max_{j∈S}{sim(i,j)}$ 总是约等于 1 ，导致 MMR 算法失效。</li>
</ol>
<p>针对这个问题提出的<strong>解决方案</strong>就是：设置一个滑动窗口 W （比如最近选择的10个物品），用 W 代替公式中的 S 。则得到<strong>使用滑动窗口的 MMR 公式</strong>：<br>
$$<br>
\operatorname{argmax}<em>{i \in R}\left{\theta \cdot \operatorname{reward}</em>{i}-(1-\theta) \cdot \max _{j \in W}{\operatorname{sim}(i, j)}\right}<br>
$$<br>
滑动窗口的应用存在直观解释：给用户曝光的物品应当具有多样性，也就是物品两两之间不相似；但没有必要让第30个物品与第1个物品不相似，用户看到第30个物品时大概率已经忘记了第1个物品是什么了。换言之，<strong>两个离得远的物品可以相似，并不会影响用户体验</strong>；但如果两个离得近物品就应当有较大差异，否则用户能感知到缺乏多样性。</p>
<h5 id="业务规则约束下的应用">业务规则约束下的应用</h5>
<ol>
<li>
<p>每一轮先用规则排除掉 $R$ 中的部分物品，得到子集 $R^′$ ；</p>
</li>
<li>
<p>MMR 公式中的 $R$ 替换成子集 $R^′$：</p>
</li>
</ol>
<h4 id="DPP-多样性算法">DPP 多样性算法</h4>
<h5 id="原理-2">原理</h5>
<p><strong>行列式点过程</strong> (Determinantal Point Process, DPP) 是一种经典的机器学习方法，它的目标就是如何从一个集合中选出多样化的物品，与重排的目标契合。首先介绍一下其数学背景：</p>
<h6 id="超平行体：">超平行体：</h6>
<p>在二维和三维空间中，超平行体就是平行四边形和平行六面体。而在任意维上的定义为：</p>
<ol>
<li>在 d 维空间中，一组向量 $v_1,…,v_k∈R_d$ 可以确定一个 $k$ 维超平行体： $P(v_1,…,v_k)={α_1v_1+…+α_kv_k|0≤α_1,…,α_k≤1}$</li>
<li>这里要求 $k≤d$ ，例如 $d=3$ 空间中有 $k=2$ 维平行四边形</li>
</ol>
<p>对于超平行体如何求面积（二维）和体积（三维），实际上使用的是施密特（Schmidt）正交化的思想，将不正交的向量组转化为正交的向量组，方便计算面积与体积。如果都是单位向量时，什么条件下超平行体能取最大和最小的体积，显然存在如下结论：</p>
<ol>
<li>不妨设 $v_1$、$v_2$、$v_3$ 都是单位向量；</li>
<li>当三个<strong>向量正交</strong>时，平行六面体为正方体，<strong>体积最大</strong>化 $vol(P)=1$ ；</li>
<li>当三个<strong>向量线性相关</strong>时，<strong>体积最小</strong>化 $vol(P)=0$ 。</li>
</ol>
<h6 id="实际应用-2">实际应用</h6>
<p>在实际应用中，则：</p>
<ol>
<li>
<p>给定 $k$ 个物品，将它们表征为单位向量 $v_1,…,v_k∈R_d$ ；（$k≤d$）</p>
</li>
<li>
<p>把它们作为矩阵 $V∈R^{d×k}$ 的列；</p>
</li>
<li>
<p>设 $k≤d$ ，则行列式与体积满足： $det(V^TV)=vol(P(v_1,…,v_2))^2$ ；</p>
</li>
<li>
<p>因此，可以<strong>用行列式</strong> $det(V^TV)$ <strong>衡量向量</strong> $v_1,…,v_k$ <strong>的多样性</strong></p>
</li>
</ol>
<p>个人在参考资料基础上，推导了k维超平行体体积与行列式的关系：</p>
<ol>
<li>
<p>不妨设列向量 $v_1, v_2, …, v_k∈R_d$，其中 $d≥k$</p>
</li>
<li>
<p>对向量组执行 Gram–Schmidt 正交化，得到一组两两正交向量$u_1, u_2,… ,u_k$，并记$r_{i i}=\left|u_{i}\right| \quad(i=1, \ldots, k)$，显然有：$\operatorname{vol}\left(P\left(v_{1}, \ldots, v_{k}\right)\right)=\prod_{i=1}^{k} r_{i i}$</p>
</li>
<li>
<p>令 $Q=\left[\frac{u_{1}}{r_{11}} \cdots \frac{u_{k}}{r_{k k}}\right] \in \mathbb{R}^{d \times k}$。它满足 $Q^{\mathrm T}Q=I_k$。再令<br>
$$<br>
R=\left[\begin{array}{cccc}r_{11} &amp; * &amp; \ldots &amp; * \0 &amp; r_{22} &amp; \ldots &amp; * \\vdots &amp; \vdots &amp; \ddots &amp; \vdots \0 &amp; 0 &amp; \ldots &amp; r_{k k}\end{array}\right] \in \mathbb{R}^{k \times k},<br>
$$<br>
那么 Gram–Schmidt 过程可写为<br>
$$<br>
V=QR.<br>
$$</p>
</li>
<li>
<p>因为 $R$ 上三角，对角线上恰好是 $r_{11},\dots ,r_{kk}$，故$\operatorname{det}\left(R^{\mathrm{T}} R\right)=\left(\prod_{i=1}^{k} r_{i i}\right)^{2}=\operatorname{vol}\left(P\left(v_{1}, \ldots, v_{k}\right)\right)^{2}$</p>
</li>
<li>
<p>由 $V=QR$ 及 $Q^{\mathrm T}Q=I_k$ 得：$V^{\mathrm{T}} V=R^{\mathrm{T}} Q^{\mathrm{T}} Q R=R^{\mathrm{T}} R$，从而有：<br>
$$<br>
\operatorname{det}\left(V^{\mathrm{T}} V\right)=\operatorname{det}\left(R^{\mathrm{T}} R\right)=\operatorname{vol}\left(P\left(v_{1}, \ldots, v_{k}\right)\right)^{2}<br>
$$</p>
</li>
</ol>
<p>因此之前所介绍的多样性问题可以被如下描述：</p>
<ol>
<li>
<p>设有 n 个物品，向量表征为：$v_1,…,v_n∈R_d$ ，精排给这些物品打分为： $reward_1,…,reward_n$ ；</p>
</li>
<li>
<p>现在从 n 个物品中选出 k 个物品，组成集合 S ，要求：</p>
<ul>
<li>
<p><strong>价值大</strong>：分数之和 $∑_{j∈S}reward_j$ 越大越好；</p>
</li>
<li>
<p><strong>多样性好</strong>：$S$ 中 $k$ 个向量组成的超平行体 $P(S)$ 的体积越大越好。</p>
</li>
</ul>
</li>
<li>
<p>将集合 $S$ 中的 $k$ 个物品向量组成矩阵 $V_S∈R_{d×k}$ ，其中 $k≤d$ 。此时有 $det(V_S^TV_S)=vol(P(S))^2$ ，说明行列式等价于体积，故实际<strong>使用行列式衡量多样性</strong>。</p>
</li>
</ol>
<h5 id="相关工作：">相关工作：</h5>
<h6 id="Hulu-LLC">Hulu LLC</h6>
<p>Hulu 对该应用研究的主要贡献在于提出了**快速求解的方法。**一般来说，<strong>DPP 的求解思想</strong>如下,暴力算法的总时间复杂度为：$O(n^2d+nk^4)$：</p>
<ol>
<li>设 A 为 $n×n$ 的矩阵，它的 $(i,j)$ 元素为 $a_{ij}=v_i^Tv_j$ ；给定向量 $v_1,…,v_n∈R_d$ ，则需要 $O(n^2d)$ 时间计算 $A$ ；</li>
<li>那么 $A_S=V_S^TV_S$ 是 A 的一个 $k×k$ 子矩阵，如果 $i,j∈S$ 时，则 $a_{ij}$ 是 $A_S$ 的一个元素；替换后的 DPP 应用在推荐系统的公式写作：$argmax_{S:|S|=k}{θ⋅(∑j∈Srewardj)+(1−θ)⋅log(det(AS))}$ 。</li>
<li>DPP 是个组合优化问题，从集合 ${1,…,n}$ 中选出一个大小为 $k$ 的子集 $S$ 。用 $S$ 表示已选中的物品，用 $R$ 表示未选中的物品，使用<strong>贪心算法</strong>求解： $argmax_{i∈R}{θ⋅reward_i+(1−θ)⋅log(det(A_S∪{i}))}$ ，寻找下一个物品 $i$ 且该物品价值尽量大、多样性尽量好。</li>
<li>其中 $A_S∪{i}$ 可以这样理解：寻找下一个物品 $i$ ，给集合 $S$ 添加一个新物品，所以在原本 $A_S$ 的基础上添加了一行一列。同时，我们希望添加的物品 $i$ 使得行列式尽可能大，也就是说不能与集合 $S$ 中的物品相似，否则行列式接近于零。</li>
</ol>
<p>Hulu 的论文设计了一种<strong>快速数值算法</strong>，使用<strong>Cholesky 分解</strong>花费 $O(nk^2)$ 时间计算所有行列式，仅仅需要 $O(n^2d+nk^2)$ 的时间从 n 个物品中选出 k 个物品。该算法思想如下：</p>
<ol>
<li>Cholseky 分解 $A_S=LL^T$ ，其中 $L$ 是下三角矩阵；</li>
<li>Cholseky 分解得到可供计算 $A_S$ 的行列式：</li>
</ol>
<p>​	下三角矩阵 L 的行列式 $det(L)$ 等于 $L$ 对角线元素乘积；故 $A_S$ 的行列式为 $det(A_S)=det(L)^2=∏_il_{ii}^2$ ；</p>
<ol start="3">
<li>每一轮循环，基于上一轮的 $A_S=LL^T$ ，可以快速求出所有 $A_S∪{i}$ 的 Cholseky 分解，因此可以快速算出所有 $A_S∪{i}$ 的行列式。</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://yanglingsanshan.github.io">舲.</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://yanglingsanshan.github.io/2025/04/22/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%89/">https://yanglingsanshan.github.io/2025/04/22/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://yanglingsanshan.github.io" target="_blank">YangLingSanShan</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">推荐系统</a></div><div class="post-share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/04/18/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%86%B7%E5%90%AF%E5%8A%A8%EF%BC%89/" title="推荐系统学习（冷启动）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">推荐系统学习（冷启动）</div></div><div class="info-2"><div class="info-item-1">冷启动 冷启动介绍 冷启动： 对于新注册的用户或者新入库的标的物, 该怎么给新用户推荐标的物让用户满意，怎么将新标的物分发出去，推荐给喜欢它的用户。 如果是新开发的产品，初期用户很少，用户行为也不多，常用的协同过滤、深度学习等依赖大量用户行为的算法不能很好的训练出精准的推荐模型, 怎么让推荐系统很好的运转起来，让推荐变得越来越准确，这个问题就是系统冷启动。 分类：   标的物冷启动：也称为“物品冷启动”或“内容冷启动”，指的是系统中新增了某个推荐对象（如商品、电影、文章等），但由于该物品还没有用户互动数据（点击、评分、购买等），导致系统无法判断哪些用户可能喜欢它。   用户冷启动：指的是系统中新增用户或活跃度极低的用户，由于其没有或几乎没有行为数据，系统难以判断该用户的兴趣偏好，难以进行个性化推荐。   **系统冷启动： 整个推荐系统刚刚上线或处于早期阶段，缺乏足够的用户数据和物品数据，导致推荐算法无法有效学习   冷启动挑战：  我们一般对新用户知之甚少，...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/09/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88CTR%E9%A2%84%E4%BC%B0%EF%BC%89/" title="推荐系统学习（CTR预估）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-09</div><div class="info-item-2">推荐系统学习（CTR预估）</div></div><div class="info-2"><div class="info-item-1">CTR预估 FM 因子分解机  论文链接：Factorization Machines  介绍： 作为逻辑回归模型LR的改进版，拟解决在稀疏数据的场景下模型参数难以训练的问题。并且考虑了特征的二阶交叉，弥补了逻辑回归表达能力差的缺陷。 原理： $$ y=\omega_{0}+\sum_{i=1}^{n} \omega_{i} x_{i}+\sum_{i=1}^{n-1} \sum_{j=i+1}^{n} \omega_{i j} x_{i} x_{j} $$ 在线性模型的基础上添加了一个多项式(最后一项)，用于描述特征之间的二阶交叉。但是参数学习困难，因为对 $w_{ij}$ 进行更新时，求得的梯度对应为$x_i$、 $x_j$，当且仅当二者都非 0 时参数才会得到更新。因此引入辅助向量，使用内积： $$ \hat{y}(\mathbf{x}):=w_{0}+\sum_{i=1}^{n} w_{i} x_{i}+\sum_{i=1}^{n} \sum_{j=i+1}^{n}\left\langle\mathbf{v}{i}, \mathbf{v}{j}\right\rangle...</div></div></div></a><a class="pagination-related" href="/2025/04/18/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%86%B7%E5%90%AF%E5%8A%A8%EF%BC%89/" title="推荐系统学习（冷启动）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-18</div><div class="info-item-2">推荐系统学习（冷启动）</div></div><div class="info-2"><div class="info-item-1">冷启动 冷启动介绍 冷启动： 对于新注册的用户或者新入库的标的物, 该怎么给新用户推荐标的物让用户满意，怎么将新标的物分发出去，推荐给喜欢它的用户。 如果是新开发的产品，初期用户很少，用户行为也不多，常用的协同过滤、深度学习等依赖大量用户行为的算法不能很好的训练出精准的推荐模型, 怎么让推荐系统很好的运转起来，让推荐变得越来越准确，这个问题就是系统冷启动。 分类：   标的物冷启动：也称为“物品冷启动”或“内容冷启动”，指的是系统中新增了某个推荐对象（如商品、电影、文章等），但由于该物品还没有用户互动数据（点击、评分、购买等），导致系统无法判断哪些用户可能喜欢它。   用户冷启动：指的是系统中新增用户或活跃度极低的用户，由于其没有或几乎没有行为数据，系统难以判断该用户的兴趣偏好，难以进行个性化推荐。   **系统冷启动： 整个推荐系统刚刚上线或处于早期阶段，缺乏足够的用户数据和物品数据，导致推荐算法无法有效学习   冷启动挑战：  我们一般对新用户知之甚少，...</div></div></div></a><a class="pagination-related" href="/2025/04/15/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88Word2vec%EF%BC%89/" title="推荐系统学习（Word2vec）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-15</div><div class="info-item-2">推荐系统学习（Word2vec）</div></div><div class="info-2"><div class="info-item-1">推荐系统学习（Word2vec）  参考文献 Word2Vec Tutorial - The Skip-Gram Model · Chris McCormick Mikolov, Tomas, et al. “Distributed representations of words and phrases and their compositionality.” Advances in neural information processing systems 26 (2013). Mikolov, Tomas, et al. “Efficient estimation of word representations in vector space.” arXiv preprint arXiv:1301.3781 (2013)  CBoW &amp; Skip-gram模型架构 2003年，Bengio等人发表了一篇开创性的文章：A neural probabilistic language...</div></div></div></a><a class="pagination-related" href="/2025/04/11/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%8F%AC%E5%9B%9E%EF%BC%89/" title="推荐系统学习（召回）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">推荐系统学习（召回）</div></div><div class="info-2"><div class="info-item-1">召回 介绍 召回是推荐系统链路中的第一个流程，目的是从几亿的item中选出几千item。进行召回的模型方法是多种多样，包括但不仅限于基于统计学的、基于规则的和基于神经网络的。 传统方法 协同过滤方法 定义： 通过分析用户或者事物之间的相似性（“协同”），来预测用户可能感兴趣的内容并将此内容推荐给用户。协同过滤有泛化能力弱、热门物品头部效应强的弱点 UserCF 原理： 如果用户 $user1$  与用户 $user2$ 相似，而且 $user2$ 喜欢某物品 $item1$ ，那么 $user1$ 很可能也喜欢该物品。根据该思想，UserCF的实现需要基于以下步骤:  基于转化流程中的动作得到用户对某物品的兴趣分数 $ like(user_j,item) $ ; 离线计算得到的用户之间的相似度 $sim(user_j,user_i)$ ； 线上预估用户对候选物品的兴趣:$\sum_j(like(user_j, item) \times sim(user_j,...</div></div></div></a><a class="pagination-related" href="/2025/04/11/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%80%89%E6%8B%A9%E6%80%A7%E5%81%8F%E5%B7%AE%EF%BC%89/" title="推荐系统学习（选择性偏差）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-11</div><div class="info-item-2">推荐系统学习（选择性偏差）</div></div><div class="info-2"><div class="info-item-1">推荐系统中的Selection bias 推荐系统中的bias Selection bias：当用户能够自由地选择给哪些物品打分的时候，则评分数据不是随机丢失的（missing not at random, MNAR），观测到的交互数据的分布将不能代表整体数据的分布。（当用户拥有自由选择权的时候，更倾向于给自己喜欢的物品打分。） Conformity bias：用户的打分会倾向于和群体一致，即使群体的打分有时候和用户的判断是有区别的，用户的这种倾向将使得评分并不能准确反映用户的偏好。大部分人都有从众的倾向，当用户发现自己的判断与大众不一致时，很可能改变自己的评分，而让自己的评分向大众的评分靠拢。 Exposure bias：用户只会暴露在一部分的物品上，因此没有交互过的物品不一定是用户不喜欢的，还可能是用户没看到。用户和物品没有交互存在两种可能性：用户没看到物品、用户不喜欢物品，直接讲没有交互过的物品当作负样本（用户不喜欢）会引入偏差。 Position...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">舲.</div><div class="author-info-description">剪影的你轮廓太好看
凝住眼泪才敢细看</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">3</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/YangLingSanShan"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">轨迹改变角落交错，寂寞城市又再探戈，天空闪过灿烂花火，和你不再为爱奔波。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E5%BA%8F"><span class="toc-number">1.</span> <span class="toc-text">重排序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E5%BA%8F%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">重排序的必要性：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E5%BA%8F%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">重排序定义：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%85%E8%A6%81%E6%80%A7%EF%BC%9A"><span class="toc-number">1.1.2.</span> <span class="toc-text">必要性：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%8E%92%E7%9B%AE%E6%A0%87%EF%BC%9A"><span class="toc-number">1.1.3.</span> <span class="toc-text">重排目标：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">1.1.4.</span> <span class="toc-text">存在问题：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%A4%9A%E6%A0%B7%E6%80%A7"><span class="toc-number">1.2.</span> <span class="toc-text">推荐系统中的多样性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%A9%E5%93%81%E7%9B%B8%E4%BC%BC%E6%80%A7%E7%9A%84%E5%BA%A6%E9%87%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">物品相似性的度量</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E5%93%81%E5%B1%9E%E6%80%A7%E6%A0%87%E7%AD%BE%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">物品属性标签方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%A9%E5%93%81%E5%90%91%E9%87%8F%E8%A1%A8%E5%BE%81"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">物品向量表征</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">提升多样性的方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MMR-%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">MMR 多样性算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.2.1.1.</span> <span class="toc-text">原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.2.1.2.</span> <span class="toc-text">实际应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%9A%E5%8A%A1%E8%A7%84%E5%88%99%E7%BA%A6%E6%9D%9F%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.2.1.3.</span> <span class="toc-text">业务规则约束下的应用</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DPP-%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">DPP 多样性算法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E7%90%86-2"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B6%85%E5%B9%B3%E8%A1%8C%E4%BD%93%EF%BC%9A"><span class="toc-number">1.2.2.2.1.1.</span> <span class="toc-text">超平行体：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8-2"><span class="toc-number">1.2.2.2.1.2.</span> <span class="toc-text">实际应用</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B7%A5%E4%BD%9C%EF%BC%9A"><span class="toc-number">1.2.2.2.2.</span> <span class="toc-text">相关工作：</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Hulu-LLC"><span class="toc-number">1.2.2.2.2.1.</span> <span class="toc-text">Hulu LLC</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/22/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%87%8D%E6%8E%92%E5%BA%8F%EF%BC%89/" title="推荐系统学习（重排序）">推荐系统学习（重排序）</a><time datetime="2025-04-22T03:47:00.000Z" title="发表于 2025-04-22 11:47:00">2025-04-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/18/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%86%B7%E5%90%AF%E5%8A%A8%EF%BC%89/" title="推荐系统学习（冷启动）">推荐系统学习（冷启动）</a><time datetime="2025-04-18T08:58:00.000Z" title="发表于 2025-04-18 16:58:00">2025-04-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/15/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88Word2vec%EF%BC%89/" title="推荐系统学习（Word2vec）">推荐系统学习（Word2vec）</a><time datetime="2025-04-15T09:27:44.000Z" title="发表于 2025-04-15 17:27:44">2025-04-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/11/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E9%80%89%E6%8B%A9%E6%80%A7%E5%81%8F%E5%B7%AE%EF%BC%89/" title="推荐系统学习（选择性偏差）">推荐系统学习（选择性偏差）</a><time datetime="2025-04-11T07:55:24.000Z" title="发表于 2025-04-11 15:55:24">2025-04-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/04/11/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%EF%BC%88%E5%8F%AC%E5%9B%9E%EF%BC%89/" title="推荐系统学习（召回）">推荐系统学习（召回）</a><time datetime="2025-04-11T03:57:13.000Z" title="发表于 2025-04-11 11:57:13">2025-04-11</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By 舲.</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>